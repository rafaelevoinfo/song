

ALTER TABLE TRANSFERENCIA_FINANCEIRA
    ADD TIPO SMALLINT NOT NULL;

COMMENT ON COLUMN TRANSFERENCIA_FINANCEIRA.TIPO IS
'0 - Overhead
1 - Emprestimo
2 - Devolucao de Emprestimo';



UPDATE TRANSFERENCIA_FINANCEIRA
SET TIPO = 0;



CREATE TABLE DOACAO (
    ID INTEGER NOT NULL,
    ID_PESSOA_DOADORA INTEGER NOT NULL,
    ID_PESSOA_RECEBEU INTEGER NOT NULL,
    ID_CONTA INTEGER NOT NULL,
    VALOR NUMERIC(15,2) NOT NULL,
    DATA TIMESTAMP NOT NULL,
    OBSERVACAO D_DESCRICAO);

ALTER TABLE DOACAO
ADD CONSTRAINT PK_DOACAO
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_DOACAO;



ALTER TABLE DOACAO
ADD CONSTRAINT FK_DOACAO_1
FOREIGN KEY (ID_PESSOA_DOADORA)
REFERENCES PESSOA(ID)
ON UPDATE CASCADE;

ALTER TABLE DOACAO
ADD CONSTRAINT FK_DOACAO_2
FOREIGN KEY (ID_PESSOA_RECEBEU)
REFERENCES PESSOA(ID)
ON UPDATE CASCADE;

ALTER TABLE DOACAO
ADD CONSTRAINT FK_DOACAO_3
FOREIGN KEY (ID_CONTA)
REFERENCES FUNDO(ID)
ON UPDATE CASCADE;



ALTER TABLE DOACAO DROP CONSTRAINT FK_DOACAO_3;



ALTER TABLE DOACAO
    ALTER ID_CONTA TO ID_FUNDO;



ALTER TABLE DOACAO
ADD CONSTRAINT FK_DOACAO_3
FOREIGN KEY (ID_FUNDO)
REFERENCES FUNDO(ID)
ON UPDATE CASCADE;



CREATE INDEX DOACAO_IDX1
ON DOACAO (VALOR);

