

ALTER TABLE ESPECIE
    ADD INICIO_PERIODO_COLETA DATE,
    ADD FIM_PERIODO_COLETA DATE;

COMMENT ON COLUMN ESPECIE.INICIO_PERIODO_COLETA IS
'Inicio do periodo ideal para realizar a coleta das sementes';

COMMENT ON COLUMN ESPECIE.FIM_PERIODO_COLETA IS
'Fim do periodo ideal para realizar a coleta das sementes';



CREATE TABLE LOTE_SEMENTE (
    ID                 INTEGER NOT NULL,
    ID_ESPECIE         INTEGER NOT NULL,
    ID_PESSOA_COLETOU  INTEGER NOT NULL,
    NOME               VARCHAR(30) NOT NULL,
    DATA               DATE NOT NULL,
    QTDE               NUMERIC(15,2) NOT NULL,
    QTDE_ARMAZENADA    NUMERIC(15,2),
    TAXA_GERMINACAO    NUMERIC(15,2),
    TAXA_DESCARTE      COMPUTED BY (100-TAXA_GERMINACAO),
    STATUS             SMALLINT
);


ALTER TABLE LOTE_SEMENTE ADD CONSTRAINT PK_LOTE_SEMENTE PRIMARY KEY (ID);


ALTER TABLE LOTE_SEMENTE ADD CONSTRAINT FK_LOTE_SEMENTE_1 FOREIGN KEY (ID_PESSOA_COLETOU) REFERENCES PESSOA (ID) ON UPDATE CASCADE;
ALTER TABLE LOTE_SEMENTE ADD CONSTRAINT FK_LOTE_SEMENTE_2 FOREIGN KEY (ID_ESPECIE) REFERENCES ESPECIE (ID) ON UPDATE CASCADE;


COMMENT ON COLUMN LOTE_SEMENTE.DATA IS
'Data de coleta ou da compra';

COMMENT ON COLUMN LOTE_SEMENTE.QTDE IS
'Qtde de sementes coletadas/compradas em kilos';

COMMENT ON COLUMN LOTE_SEMENTE.QTDE_ARMAZENADA IS
'Qtde em kilos de sementes em estoque';

COMMENT ON COLUMN LOTE_SEMENTE.TAXA_GERMINACAO IS
'Percentual de germinacao desse lote';

COMMENT ON COLUMN LOTE_SEMENTE.TAXA_DESCARTE IS
'Taxa de descarte desse lote (100 - Taxa de Germinacao)';

COMMENT ON COLUMN LOTE_SEMENTE.STATUS IS
'0|NULL - Aberto (Processo de semeadura e germinacao em andamento)
1 - Fechado (Semeadura e germinacao finalizados)';



CREATE TABLE LOTE_SEMENTE_MATRIZ (
    ID         INTEGER NOT NULL,
    ID_LOTE    INTEGER NOT NULL,
    ID_MATRIZ  INTEGER NOT NULL
);

ALTER TABLE LOTE_SEMENTE_MATRIZ ADD CONSTRAINT PK_LOTE_SEMENTE_MATRIZ PRIMARY KEY (ID);

ALTER TABLE LOTE_SEMENTE_MATRIZ ADD CONSTRAINT FK_LOTE_SEMENTE_MATRIZ_1 FOREIGN KEY (ID_LOTE) REFERENCES LOTE_SEMENTE (ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE LOTE_SEMENTE_MATRIZ ADD CONSTRAINT FK_LOTE_SEMENTE_MATRIZ_2 FOREIGN KEY (ID_MATRIZ) REFERENCES MATRIZ (ID) ON UPDATE CASCADE;


delete from lote;

delete from germinacao;

delete from semeadura;

DROP TABLE LOTE_MATRIZ;








ALTER TABLE GERMINACAO DROP CONSTRAINT FK_GERMINACAO_1;



ALTER TABLE GERMINACAO ALTER ID_LOTE TO ID_LOTE_SEMENTE;



ALTER TABLE GERMINACAO
ADD CONSTRAINT FK_GERMINACAO_1
FOREIGN KEY (ID_LOTE_SEMENTE)
REFERENCES LOTE_SEMENTE(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



ALTER TABLE SEMEADURA DROP CONSTRAINT FK_SEMEADURA_1;



ALTER TABLE SEMEADURA ALTER ID_LOTE TO ID_LOTE_SEMEADURA;



ALTER TABLE SEMEADURA ALTER ID_LOTE_SEMEADURA TO ID_LOTE_SEMENTE;



ALTER TABLE SEMEADURA
ADD CONSTRAINT FK_SEMEADURA_1
FOREIGN KEY (ID_LOTE_SEMENTE)
REFERENCES LOTE_SEMENTE(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



DROP TABLE LOTE;



ALTER TABLE LOTE_SEMENTE_MATRIZ DROP CONSTRAINT FK_LOTE_SEMENTE_MATRIZ_1;



ALTER TABLE LOTE_SEMENTE_MATRIZ ALTER ID_LOTE TO ID_LOTE_SEMENTE;



ALTER TABLE LOTE_SEMENTE_MATRIZ
ADD CONSTRAINT FK_LOTE_SEMENTE_MATRIZ_1
FOREIGN KEY (ID_LOTE_SEMENTE)
REFERENCES LOTE_SEMENTE(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



DROP SEQUENCE GEN_LOTE;

CREATE SEQUENCE GEN_LOTE_SEMENTE;



DROP SEQUENCE GEN_LOTE_MATRIZ;

CREATE SEQUENCE GEN_LOTE_SEMENTE_MATRIZ;

ALTER SEQUENCE GEN_LOTE_SEMENTE_MATRIZ RESTART WITH 15;



ALTER TABLE SEMEADURA
    ADD QTDE_TUBETE INTEGER;

COMMENT ON COLUMN SEMEADURA.QTDE_TUBETE IS
'Qtde. tubetes semeados';



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'QTDE_TUBETE') and
(RDB$RELATION_NAME = 'SEMEADURA')
;



alter table SEMEADURA
alter ID position 1;

alter table SEMEADURA
alter ID_LOTE_SEMENTE position 2;

alter table SEMEADURA
alter ID_PESSOA_SEMEOU position 3;

alter table SEMEADURA
alter ID_CANTEIRO position 4;

alter table SEMEADURA
alter QTDE_SEMEADA position 5;

alter table SEMEADURA
alter QTDE_TUBETE position 6;

alter table SEMEADURA
alter DATA position 7;

alter table SEMEADURA
alter DATA_PREVISTA_GERMINACAO position 8;

alter table SEMEADURA
alter OBSERVACAO position 9;



CREATE TABLE LOTE_MUDA (
    ID INTEGER NOT NULL,
    ID_ESPECIE INTEGER NOT NULL,
    NOME D_NOME NOT NULL,
    QTDE INTEGER NOT NULL,
    QTDE_INICIAL INTEGER NOT NULL,
    DATA TIMESTAMP NOT NULL);

ALTER TABLE LOTE_MUDA
ADD CONSTRAINT PK_LOTE_MUDA
PRIMARY KEY (ID);

COMMENT ON COLUMN LOTE_MUDA.QTDE IS
'Qtde atual de mudas no lote';

COMMENT ON COLUMN LOTE_MUDA.QTDE_INICIAL IS
'Qtde. inicial de mudas do lote';

COMMENT ON COLUMN LOTE_MUDA.DATA IS
'Data e Hora da inclusão do lote';

CREATE SEQUENCE GEN_LOTE_MUDA;



ALTER TABLE LOTE_MUDA
    ADD ID_PESSOA INTEGER;

COMMENT ON COLUMN LOTE_MUDA.ID_PESSOA IS
'Pessoa que incluiu o lote';

alter table LOTE_MUDA
alter ID position 1;

alter table LOTE_MUDA
alter ID_ESPECIE position 2;

alter table LOTE_MUDA
alter ID_PESSOA position 3;

alter table LOTE_MUDA
alter NOME position 4;

alter table LOTE_MUDA
alter QTDE position 5;

alter table LOTE_MUDA
alter QTDE_INICIAL position 6;

alter table LOTE_MUDA
alter DATA position 7;



ALTER TABLE LOTE_MUDA
ADD CONSTRAINT FK_LOTE_MUDA_2
FOREIGN KEY (ID_PESSOA)
REFERENCES PESSOA(ID)
ON UPDATE caSCADE;



ALTER TABLE LOTE_MUDA
    ADD OBSERVACAO D_DESCRICAO;



CREATE TABLE CLASSIFICACAO (
    ID INTEGER NOT NULL,
    ID_PESSOA_CLASSIFICOU INTEGER NOT NULL,
    DATA DATE NOT NULL,
    QTDE INTEGER NOT NULL,
    OBSERVACAO D_DESCRICAO);

ALTER TABLE CLASSIFICACAO
ADD CONSTRAINT PK_CLASSIFICACAO
PRIMARY KEY (ID);

COMMENT ON COLUMN CLASSIFICACAO.QTDE IS
'Qtde. de mudas ainda existentes';

CREATE SEQUENCE GEN_CLASSIFICACAO;



ALTER TABLE CLASSIFICACAO
    ADD ID_LOTE_MUDA INTEGER;

alter table CLASSIFICACAO
alter ID position 1;

alter table CLASSIFICACAO
alter ID_LOTE_MUDA position 2;

alter table CLASSIFICACAO
alter ID_PESSOA_CLASSIFICOU position 3;

alter table CLASSIFICACAO
alter DATA position 4;

alter table CLASSIFICACAO
alter QTDE position 5;

alter table CLASSIFICACAO
alter OBSERVACAO position 6;



ALTER TABLE CLASSIFICACAO
ADD CONSTRAINT FK_CLASSIFICACAO_1
FOREIGN KEY (ID_LOTE_MUDA)
REFERENCES LOTE_MUDA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE CLASSIFICACAO
ADD CONSTRAINT FK_CLASSIFICACAO_2
FOREIGN KEY (ID_PESSOA_CLASSIFICOU)
REFERENCES PESSOA(ID)
ON UPDATE CASCADE;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'ID_LOTE_MUDA') and
(RDB$RELATION_NAME = 'CLASSIFICACAO')
;



ALTER TABLE LOTE_MUDA DROP ID_PESSOA;



ALTER TABLE LOTE_MUDA
    ADD ID_LOTE_SEMENTE INTEGER;

alter table LOTE_MUDA
alter ID position 1;

alter table LOTE_MUDA
alter ID_ESPECIE position 2;

alter table LOTE_MUDA
alter ID_LOTE_SEMENTE position 3;

alter table LOTE_MUDA
alter NOME position 4;

alter table LOTE_MUDA
alter QTDE position 5;

alter table LOTE_MUDA
alter QTDE_INICIAL position 6;

alter table LOTE_MUDA
alter DATA position 7;

alter table LOTE_MUDA
alter OBSERVACAO position 8;



ALTER TABLE LOTE_MUDA
ADD CONSTRAINT FK_LOTE_MUDA_2
FOREIGN KEY (ID_LOTE_SEMENTE)
REFERENCES LOTE_SEMENTE(ID)
ON UPDATE CASCADE;



ALTER DOMAIN D_DESCRICAO
TYPE VARCHAR(1000) CHARACTER SET WIN1252;



ALTER TABLE LOTE_MUDA DROP QTDE;



ALTER TABLE LOTE_MUDA
    ALTER DATA TYPE DATE;



ALTER TABLE GERMINACAO
    ALTER DATA TYPE DATE;



ALTER TABLE FIN_FOR_CLI
    ADD CARGO_CONTATO D_NOME;

alter table FIN_FOR_CLI
alter ID position 1;

alter table FIN_FOR_CLI
alter ID_CONTATO position 2;

alter table FIN_FOR_CLI
alter ID_CIDADE position 3;

alter table FIN_FOR_CLI
alter NOME_FANTASIA position 4;

alter table FIN_FOR_CLI
alter RAZAO_SOCIAL position 5;

alter table FIN_FOR_CLI
alter CARGO_CONTATO position 6;

alter table FIN_FOR_CLI
alter ENDERECO position 7;

alter table FIN_FOR_CLI
alter BAIRRO position 8;

alter table FIN_FOR_CLI
alter COMPLEMENTO position 9;

alter table FIN_FOR_CLI
alter TIPO position 10;

alter table FIN_FOR_CLI
alter TELEFONE position 11;

alter table FIN_FOR_CLI
alter CELULAR position 12;

alter table FIN_FOR_CLI
alter EMAIL position 13;

alter table FIN_FOR_CLI
alter SITE position 14;

alter table FIN_FOR_CLI
alter CPF_CNPJ position 15;

alter table FIN_FOR_CLI
alter INSCRICAO_ESTADUAL position 16;

alter table FIN_FOR_CLI
alter INSCRICAO_MUNICIPAL position 17;

alter table FIN_FOR_CLI
alter RAMO_ATIVIDADE position 18;

alter table FIN_FOR_CLI
alter PESQUISA position 19;

alter table FIN_FOR_CLI
alter OBSERVACAO position 20;



CREATE TABLE AREA_CUSTO (
    ID INTEGER NOT NULL,
    NOME D_NOME NOT NULL);

ALTER TABLE AREA_CUSTO
ADD CONSTRAINT PK_AREA_CUSTO
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_AREA_CUSTO;



CREATE TABLE RUBRICA (
    ID INTEGER NOT NULL);

ALTER TABLE RUBRICA
ADD CONSTRAINT PK_RUBRICA
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_RUBRICA;



CREATE TABLE PLANO_CONTAS (
    ID INTEGER NOT NULL,
    ID_CONTA_PAI INTEGER,
    NOME INTEGER,
    TIPO SMALLINT);

ALTER TABLE PLANO_CONTAS
ADD CONSTRAINT PK_PLANO_CONTAS
PRIMARY KEY (ID);

COMMENT ON COLUMN PLANO_CONTAS.TIPO IS
'0|NULL - Despesa
1 - Receita';

CREATE SEQUENCE GEN_PLANO_CONTAS;



ALTER TABLE PLANO_CONTAS
ADD CONSTRAINT FK_PLANO_CONTAS_1
FOREIGN KEY (ID_CONTA_PAI)
REFERENCES PLANO_CONTAS(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'TIPO') and
(RDB$RELATION_NAME = 'PLANO_CONTAS')
;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'NOME') and
(RDB$RELATION_NAME = 'PLANO_CONTAS')
;



COMMENT ON COLUMN PLANO_CONTAS.ID_CONTA_PAI IS
'Id da conta pai, caso tenha.';



DROP TABLE AREA_CUSTO;



ALTER TABLE PLANO_CONTAS DROP NOME;



ALTER TABLE PLANO_CONTAS
    ADD NOME D_NOME NOT NULL;

alter table PLANO_CONTAS
alter ID position 1;

alter table PLANO_CONTAS
alter ID_CONTA_PAI position 2;

alter table PLANO_CONTAS
alter NOME position 3;

alter table PLANO_CONTAS
alter TIPO position 4;



ALTER TABLE PLANO_CONTAS
    ADD IDENTIFICADOR VARCHAR(20) NOT NULL;

COMMENT ON COLUMN PLANO_CONTAS.IDENTIFICADOR IS
'Identificador numerico da conta. Exemplos:
1
1.1

5
5.1
5.2';



ALTER TABLE RUBRICA
    ADD NOME D_NOME NOT NULL,
    ADD VALOR NUMERIC(15,2);



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'VALOR') and
(RDB$RELATION_NAME = 'RUBRICA')
;



CREATE TABLE RUBRICA_PROJETO (
    ID INTEGER NOT NULL,
    ID_RUBRICA INTEGER NOT NULL,
    ID_PROJETO INTEGER NOT NULL);

ALTER TABLE RUBRICA_PROJETO
ADD CONSTRAINT PK_RUBRICA_PROJETO
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_RUBRICA_PROJETO;



ALTER TABLE RUBRICA_PROJETO
ADD CONSTRAINT FK_RUBRICA_PROJETO_1
FOREIGN KEY (ID_RUBRICA)
REFERENCES RUBRICA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE RUBRICA_PROJETO
ADD CONSTRAINT FK_RUBRICA_PROJETO_2
FOREIGN KEY (ID_PROJETO)
REFERENCES PROJETO(ID)
ON UPDATE CASCADE;



ALTER TABLE RUBRICA_PROJETO
    ADD ORCAMENTO NUMERIC(15,2) NOT NULL;



ALTER TABLE RUBRICA DROP VALOR;



CREATE TABLE PROJETO_RUBRICA (
    ID INTEGER NOT NULL,
    ID_PROJETO INTEGER NOT NULL,
    ID_RUBRICA INTEGER NOT NULL,
    ORCAMENTO NUMERIC(15,2) NOT NULL);

ALTER TABLE PROJETO_RUBRICA
ADD CONSTRAINT PK_PROJETO_RUBRICA
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_PROJETO_RUBRICA;



ALTER TABLE PROJETO_RUBRICA
ADD CONSTRAINT FK_PROJETO_RUBRICA_1
FOREIGN KEY (ID_PROJETO)
REFERENCES PROJETO(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



ALTER TABLE PROJETO_RUBRICA
ADD CONSTRAINT FK_PROJETO_RUBRICA_2
FOREIGN KEY (ID_RUBRICA)
REFERENCES RUBRICA(ID)
ON UPDATE CASCADE;



DROP TABLE RUBRICA_PROJETO;



ALTER TABLE RUBRICA
    ADD ID_RUBRICA_PAI INTEGER,
    ADD IDENTIFICADOR VARCHAR(20);

alter table RUBRICA
alter ID position 1;

alter table RUBRICA
alter ID_RUBRICA_PAI position 2;

alter table RUBRICA
alter NOME position 3;

alter table RUBRICA
alter IDENTIFICADOR position 4;



ALTER TABLE RUBRICA
ADD CONSTRAINT FK_RUBRICA_1
FOREIGN KEY (ID_RUBRICA_PAI)
REFERENCES RUBRICA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'IDENTIFICADOR') and
(RDB$RELATION_NAME = 'RUBRICA')
;



CREATE TABLE CONTA_PAGAR (
    ID INTEGER NOT NULL,
    ID_FORNECEDOR INTEGER NOT NULL,
    ID_RUBRICA INTEGER,
    ID_PLANO_CONTAS INTEGER NOT NULL,
    ID_CONTA_CORRENTE INTEGER,
    NOME D_NOME NOT NULL,
    VALOR_TOTAL NUMERIC(15,2) NOT NULL,
    FORMA_PAGTO SMALLINT,
    OBSERVACAO D_DESCRICAO);

ALTER TABLE CONTA_PAGAR
ADD CONSTRAINT PK_CONTA_PAGAR
PRIMARY KEY (ID);

COMMENT ON COLUMN CONTA_PAGAR.VALOR_TOTAL IS
'Valor total da conta';

COMMENT ON COLUMN CONTA_PAGAR.FORMA_PAGTO IS
'1 - Transferencia Bancaria
2 - Debito em Conta
3 - Cartao de Credito
4 - Cartao de Debito
5 - Cheque
6 - Outro';

CREATE SEQUENCE GEN_CONTA_PAGAR;



ALTER TABLE CONTA_PAGAR
    ALTER NOME TO DESCRICAO;



CREATE TABLE CONTA_PAGAR_PARCELA (
    ID INTEGER NOT NULL,
    ID_CONTA_PAGAR INTEGER NOT NULL,
    VENCIMENTO DATE NOT NULL,
    VALOR NUMERIC(15,2) NOT NULL,
    PARCELA SMALLINT NOT NULL);

ALTER TABLE CONTA_PAGAR_PARCELA
ADD CONSTRAINT PK_CONTA_PAGAR_PARCELA
PRIMARY KEY (ID);

COMMENT ON COLUMN CONTA_PAGAR_PARCELA.PARCELA IS
'Numero da parcela';

CREATE SEQUENCE GEN_CONTA_PAGAR_PARCELA;



ALTER TABLE CONTA_PAGAR_PARCELA
ADD CONSTRAINT FK_CONTA_PAGAR_PARCELA_1
FOREIGN KEY (ID_CONTA_PAGAR)
REFERENCES CONTA_PAGAR(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;



ALTER TABLE CONTA_PAGAR
ADD CONSTRAINT FK_CONTA_PAGAR_1
FOREIGN KEY (ID_FORNECEDOR)
REFERENCES FIN_FOR_CLI(ID)
ON UPDATE CASCADE;

ALTER TABLE CONTA_PAGAR
ADD CONSTRAINT FK_CONTA_PAGAR_2
FOREIGN KEY (ID_RUBRICA)
REFERENCES RUBRICA(ID)
ON UPDATE CASCADE;

ALTER TABLE CONTA_PAGAR
ADD CONSTRAINT FK_CONTA_PAGAR_3
FOREIGN KEY (ID_PLANO_CONTAS)
REFERENCES PLANO_CONTAS(ID)
ON UPDATE CASCADE;

ALTER TABLE CONTA_PAGAR
ADD CONSTRAINT FK_CONTA_PAGAR_4
FOREIGN KEY (ID_CONTA_CORRENTE)
REFERENCES BANCO_CONTA_CORRENTE(ID)
ON UPDATE CASCADE;



CREATE TABLE CONTA_PAGAR_PROJETO (
    ID INTEGER NOT NULL,
    ID_CONTA_PAGAR INTEGER NOT NULL,
    ID_PROJETO INTEGER NOT NULL);

ALTER TABLE CONTA_PAGAR_PROJETO
ADD CONSTRAINT PK_CONTA_PAGAR_PROJETO
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_CONTA_PAGAR_PROJETO;



ALTER TABLE CONTA_PAGAR_PROJETO
ADD CONSTRAINT FK_CONTA_PAGAR_PROJETO_1
FOREIGN KEY (ID_CONTA_PAGAR)
REFERENCES CONTA_PAGAR(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE CONTA_PAGAR_PROJETO
ADD CONSTRAINT FK_CONTA_PAGAR_PROJETO_2
FOREIGN KEY (ID_PROJETO)
REFERENCES PROJETO(ID)
ON UPDATE CASCADE;



CREATE TABLE CONTA_PAGAR_ATIVIDADE (
    ID INTEGER NOT NULL,
    ID_CONTA_PAGAR INTEGER NOT NULL,
    ID_ATIVIDADE INTEGER NOT NULL);

ALTER TABLE CONTA_PAGAR_ATIVIDADE
ADD CONSTRAINT PK_CONTA_PAGAR_ATIVIDADE
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_CONTA_PAGAR_ATIVIDADE;



ALTER TABLE CONTA_PAGAR_ATIVIDADE
ADD CONSTRAINT FK_CONTA_PAGAR_ATIVIDADE_1
FOREIGN KEY (ID_CONTA_PAGAR)
REFERENCES CONTA_PAGAR(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE CONTA_PAGAR_ATIVIDADE
ADD CONSTRAINT FK_CONTA_PAGAR_ATIVIDADE_2
FOREIGN KEY (ID_ATIVIDADE)
REFERENCES ATIVIDADE(ID)
ON UPDATE CASCADE;



DROP SEQUENCE GEN_AREA_CUSTO;

delete from projeto_financiador;

ALTER TABLE PROJETO_FINANCIADOR DROP CONSTRAINT FK_PROJETO_FINANCIADOR_2;

ALTER TABLE PROJETO_FINANCIADOR
ADD CONSTRAINT FK_PROJETO_FINANCIADOR_2
FOREIGN KEY (ID_FINANCIADOR)
REFERENCES FIN_FOR_CLI(ID)
ON UPDATE CASCADE;



DROP TABLE FINANCIADOR;



DROP SEQUENCE GEN_FINANCIADOR;



DROP SEQUENCE GEN_RUBRICA_PROJETO;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'CPF_CNPJ') and
(RDB$RELATION_NAME = 'FIN_FOR_CLI')
;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'TIPO') and
(RDB$RELATION_NAME = 'FIN_FOR_CLI')
;



ALTER TABLE FIN_FOR_CLI DROP CONSTRAINT UNQ1_FIN_FOR_CLI;



ALTER TABLE FIN_FOR_CLI DROP CONSTRAINT UNQ3_FIN_FOR_CLI;

ALTER TABLE FIN_FOR_CLI
ADD CONSTRAINT UNQ3_FIN_FOR_CLI
UNIQUE (NOME_FANTASIA,RAZAO_SOCIAL,TIPO)
USING INDEX UNQ3_FIN_FOR_CLI;



COMMENT ON COLUMN CONTA_PAGAR.FORMA_PAGTO IS
'1 - Transferencia Bancaria
2 - Debito em Conta
3 - Cartao de Credito
4 - Cartao de Debito
5 - Cheque
6 - Em Especie
7 - Outro';



ALTER TABLE CONTA_RECEBER DROP ID_CLIENTE;



ALTER TABLE CONTA_RECEBER
    ADD ID_CLIENTE_FINANCIADOR INTEGER NOT NULL;

COMMENT ON COLUMN CONTA_RECEBER.ID_CLIENTE_FINANCIADOR IS
'Id do cliente ou do financiador que irão realizar o pagamento';

alter table CONTA_RECEBER
alter ID position 1;

alter table CONTA_RECEBER
alter ID_CLIENTE_FINANCIADOR position 2;

alter table CONTA_RECEBER
alter ID_PLANO_CONTAS position 3;

alter table CONTA_RECEBER
alter ID_CONTA_CORRENTE position 4;

alter table CONTA_RECEBER
alter DESCRICAO position 5;

alter table CONTA_RECEBER
alter VALOR_TOTAL position 6;

alter table CONTA_RECEBER
alter FORMA_PAGTO position 7;

alter table CONTA_RECEBER
alter OBSERVACAO position 8;



ALTER TABLE CONTA_RECEBER
ADD CONSTRAINT FK_CONTA_RECEBER_1
FOREIGN KEY (ID_CLIENTE_FINANCIADOR)
REFERENCES FIN_FOR_CLI(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_RECEBER_PARCELA
    ADD STATUS SMALLINT,
    ADD DATA_RECEBIMENTO DATE;

COMMENT ON COLUMN CONTA_RECEBER_PARCELA.STATUS IS
'0|NULL - Em aberto
1 - Recebida';



ALTER TABLE CONTA_PAGAR_PARCELA
    ADD STATUS SMALLINT,
    ADD DATA_PAGAMENTO DATE;

COMMENT ON COLUMN CONTA_PAGAR_PARCELA.STATUS IS
'0|NULL - Em aberto
1 - Pago';



ALTER TABLE FIN_FOR_CLI DROP PESQUISA;



ALTER TABLE LOTE_MUDA
    ADD TAXA_CLASSIFICACAO NUMERIC(15,2);

COMMENT ON COLUMN LOTE_MUDA.TAXA_CLASSIFICACAO IS
'Taxa que informa a porcentagem de mudas que foram aproveitas.
Formula para calculo
Qtde Atual de Mudas * 100)/Qtde. Inicial de Mudas';



ALTER TABLE CONTA_PAGAR
    ADD NUMERO_DOCUMENTO VARCHAR(30);



ALTER TABLE CONTA_RECEBER
    ADD NUMERO_DOCUMENTO VARCHAR(30);



CREATE TABLE ITEM (
    ID INTEGER NOT NULL,
    NOME D_NOME NOT NULL,
    TIPO SMALLINT NOT NULL);

ALTER TABLE ITEM
ADD CONSTRAINT PK_ITEM
PRIMARY KEY (ID);

COMMENT ON COLUMN ITEM.TIPO IS
'0|NULL - Normal
1 - Semente
2 - Muda';

CREATE SEQUENCE GEN_ITEM;



CREATE TABLE COMPRA (
    ID INTEGER NOT NULL,
    DATA TIMESTAMP NOT NULL,
    ID_FORNECEDOR INTEGER NOT NULL,
    ID_CONTA_PAGAR INTEGER,
    VALOR NUMERIC(15,2) NOT NULL,
    ID_PESSOA_COMPROU INTEGER NOT NULL,
    DESCRICAO D_DESCRICAO);

ALTER TABLE COMPRA
ADD CONSTRAINT PK_COMPRA
PRIMARY KEY (ID);

COMMENT ON COLUMN COMPRA.ID_PESSOA_COMPROU IS
'Pessoa que realizou a compra';

CREATE SEQUENCE GEN_COMPRA;



CREATE TABLE COMPRA_ITEM (
    ID INTEGER NOT NULL,
    ID_COMPRA INTEGER NOT NULL,
    ID_ITEM INTEGER NOT NULL,
    ID_ESPECIE INTEGER,
    QTDE NUMERIC(15,2) NOT NULL,
    VALOR_UNITARIO NUMERIC(15,2) NOT NULL);

ALTER TABLE COMPRA_ITEM
ADD CONSTRAINT PK_COMPRA_ITEM
PRIMARY KEY (ID);

COMMENT ON COLUMN COMPRA_ITEM.ID_ESPECIE IS
'Caso o item seja do tipo semente ou muda';

CREATE SEQUENCE GEN_COMPRA_ITEM;



ALTER TABLE COMPRA
    ALTER VALOR TO VALOR_TOTAL;

COMMENT ON COLUMN COMPRA.VALOR_TOTAL IS
'Soma total dos itens desta compra';



ALTER TABLE COMPRA
ADD CONSTRAINT FK_COMPRA_1
FOREIGN KEY (ID_FORNECEDOR)
REFERENCES FIN_FOR_CLI(ID)
ON UPDATE CASCADE;

ALTER TABLE COMPRA
ADD CONSTRAINT FK_COMPRA_2
FOREIGN KEY (ID_CONTA_PAGAR)
REFERENCES CONTA_PAGAR(ID)
ON UPDATE CASCADE;

ALTER TABLE COMPRA
ADD CONSTRAINT FK_COMPRA_3
FOREIGN KEY (ID_PESSOA_COMPROU)
REFERENCES PESSOA(ID)
ON UPDATE CASCADE;



ALTER TABLE COMPRA_ITEM
ADD CONSTRAINT FK_COMPRA_ITEM_1
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE COMPRA_ITEM
ADD CONSTRAINT FK_COMPRA_ITEM_2
FOREIGN KEY (ID_ITEM)
REFERENCES ITEM(ID)
ON UPDATE CASCADE;

ALTER TABLE COMPRA_ITEM
ADD CONSTRAINT FK_COMPRA_ITEM_3
FOREIGN KEY (ID_ESPECIE)
REFERENCES ESPECIE(ID)
ON UPDATE CASCADE;



CREATE TABLE ENTRADA (
    ID INTEGER NOT NULL,
    ID_ITEM INTEGER NOT NULL,
    ID_ESPECIE INTEGER,
    ID_COMPRA INTEGER,
    QTDE NUMERIC(15,2) NOT NULL,
    DATA TIMESTAMP NOT NULL);

ALTER TABLE ENTRADA
ADD CONSTRAINT PK_ENTRADA
PRIMARY KEY (ID);

COMMENT ON COLUMN ENTRADA.ID_ESPECIE IS
'Id da especie quando o item for do tipo semente ou muda';

CREATE SEQUENCE GEN_ENTRADA;



ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_1
FOREIGN KEY (ID_ITEM)
REFERENCES ITEM(ID)
ON UPDATE CASCADE;

ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_2
FOREIGN KEY (ID_ESPECIE)
REFERENCES ATIVIDADE_PROJETO(ID)
ON UPDATE CASCADE;

ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_3
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRA(ID)
ON UPDATE CASCADE;



ALTER TABLE ENTRADA DROP CONSTRAINT FK_ENTRADA_2;



ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_2
FOREIGN KEY (ID_ESPECIE)
REFERENCES ESPECIE(ID)
ON UPDATE CASCADE;



ALTER TABLE ITEM
    ADD UNIDADE VARCHAR(10);

COMMENT ON COLUMN ITEM.UNIDADE IS
'Unidade de medida do item.
Para item do tipo Semente sera sempre fixo a unidade Kg
para item do tipo Muda sera sempre fixo a unidade UND';



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'UNIDADE') and
(RDB$RELATION_NAME = 'ITEM')
;



ALTER TABLE ENTRADA DROP ID_ESPECIE;



ALTER TABLE ENTRADA
    ADD ID_LOTE_SEMENTE INTEGER,
    ADD ID_LOTE_MUDA INTEGER;

alter table ENTRADA
alter ID position 1;

alter table ENTRADA
alter ID_ITEM position 2;

alter table ENTRADA
alter ID_LOTE_SEMENTE position 3;

alter table ENTRADA
alter ID_LOTE_MUDA position 4;

alter table ENTRADA
alter ID_COMPRA position 5;

alter table ENTRADA
alter QTDE position 6;

alter table ENTRADA
alter DATA position 7;



ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_2
FOREIGN KEY (ID_LOTE_SEMENTE)
REFERENCES LOTE_SEMENTE(ID)
ON UPDATE CASCADE;

ALTER TABLE ENTRADA
ADD CONSTRAINT FK_ENTRADA_4
FOREIGN KEY (ID_LOTE_MUDA)
REFERENCES LOTE_MUDA(ID)
ON UPDATE CASCADE;



COMMENT ON COLUMN ENTRADA.ID_LOTE_SEMENTE IS
'Itens do tipo semente deve possuir um vinculo com lote_semente';



COMMENT ON COLUMN ENTRADA.ID_LOTE_MUDA IS
'Itens do tipo muda deve possuir um vinculo com lote_muda';



ALTER TABLE ENTRADA DROP ID_LOTE_SEMENTE;



ALTER TABLE ENTRADA DROP ID_LOTE_MUDA;



ALTER TABLE LOTE_SEMENTE
    ADD ID_COMPRA INTEGER;

COMMENT ON COLUMN LOTE_SEMENTE.ID_COMPRA IS
'Caso as sementes tenham sido adquiridas atraves de uma compra, deve anotar aqui o id da compra';



ALTER TABLE LOTE_SEMENTE
ADD CONSTRAINT FK_LOTE_SEMENTE_3
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRA(ID)
ON UPDATE CASCADE;



CREATE TABLE SOLICITACAO_COMPRA (
    ID INTEGER NOT NULL,
    ID_ITEM INTEGER NOT NULL,
    ID_PESSOA_SOLICITOU INTEGER NOT NULL,
    ID_PESSOA_ANALISOU INTEGER,
    QTDE NUMERIC(15,2) NOT NULL,
    DATA TIMESTAMP NOT NULL,
    DATA_ANALISE TIMESTAMP,
    STATUS SMALLINT NOT NULL);

ALTER TABLE SOLICITACAO_COMPRA
ADD CONSTRAINT PK_SOLICITACAO_COMPRA
PRIMARY KEY (ID);

COMMENT ON COLUMN SOLICITACAO_COMPRA.ID_PESSOA_ANALISOU IS
'Id da pessoa que aprovou ou negou a solicitacao';

COMMENT ON COLUMN SOLICITACAO_COMPRA.STATUS IS
'0 - Solicitada
1 - Aprovada
2 - Negada';

CREATE SEQUENCE GEN_SOLICITACAO_COMPRA;



ALTER TABLE SOLICITACAO_COMPRA
    ADD ID_COMPRA INTEGER;

alter table SOLICITACAO_COMPRA
alter ID position 1;

alter table SOLICITACAO_COMPRA
alter ID_ITEM position 2;

alter table SOLICITACAO_COMPRA
alter ID_PESSOA_SOLICITOU position 3;

alter table SOLICITACAO_COMPRA
alter ID_PESSOA_ANALISOU position 4;

alter table SOLICITACAO_COMPRA
alter ID_COMPRA position 5;

alter table SOLICITACAO_COMPRA
alter QTDE position 6;

alter table SOLICITACAO_COMPRA
alter DATA position 7;

alter table SOLICITACAO_COMPRA
alter DATA_ANALISE position 8;

alter table SOLICITACAO_COMPRA
alter STATUS position 9;



ALTER TABLE SOLICITACAO_COMPRA
ADD CONSTRAINT FK_SOLICITACAO_COMPRA_4
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRA(ID)
ON UPDATE CASCADE;



CREATE TABLE PROJETO_AREA (
    ID INTEGER NOT NULL,
    ID_PROJETO INTEGER NOT NULL,
    NOME D_NOME NOT NULL);

ALTER TABLE PROJETO_AREA
ADD CONSTRAINT PK_PROJETO_AREA
PRIMARY KEY (ID);

COMMENT ON COLUMN PROJETO_AREA.NOME IS
'Nome da área';

CREATE SEQUENCE GEN_PROJETO_AREA;



ALTER TABLE PROJETO_AREA
ADD CONSTRAINT FK_PROJETO_AREA_1
FOREIGN KEY (ID_PROJETO)
REFERENCES PROJETO(ID)
ON UPDATE CASCADE;



ALTER TABLE PROJETO_AREA
ADD CONSTRAINT UNQ1_PROJETO_AREA
UNIQUE (ID_PROJETO,NOME);



ALTER TABLE PROJETO_RUBRICA
    ADD RECEBIDO NUMERIC(15,2),
    ADD GASTO NUMERIC(15,2);

COMMENT ON COLUMN PROJETO_RUBRICA.ORCAMENTO IS
'Valor previsto para esta rubrica';

COMMENT ON COLUMN PROJETO_RUBRICA.RECEBIDO IS
'Valor ja recebido';

COMMENT ON COLUMN PROJETO_RUBRICA.GASTO IS
'Valor que ja foi gasto';



ALTER TABLE PROJETO_FINANCIADOR_PAGTO
    ADD PERCENTUAL NUMERIC(15,2) NOT NULL;

COMMENT ON COLUMN PROJETO_FINANCIADOR_PAGTO.PERCENTUAL IS
'Percentual referente ao valor total';



UPDATE PROJETO_FINANCIADOR_PAGTO
SET PERCENTUAL = 10;



ALTER TABLE CONTA_PAGAR DROP ID_RUBRICA;



ALTER TABLE CONTA_PAGAR_ATIVIDADE
    ADD ID_RUBRICA INTEGER NOT NULL;



ALTER TABLE CONTA_PAGAR_ATIVIDADE
ADD CONSTRAINT FK_CONTA_PAGAR_ATIVIDADE_3
FOREIGN KEY (ID_RUBRICA)
REFERENCES RUBRICA(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_PAGAR_PROJETO
    ADD ID_RUBRICA INTEGER NOT NULL;



ALTER TABLE CONTA_PAGAR_PROJETO
ADD CONSTRAINT FK_CONTA_PAGAR_PROJETO_3
FOREIGN KEY (ID_RUBRICA)
REFERENCES RUBRICA(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_PAGAR_PROJETO
    ADD ID_PROJETO_AREA INTEGER NOT NULL;



ALTER TABLE CONTA_PAGAR_PROJETO
ADD CONSTRAINT FK_CONTA_PAGAR_PROJETO_4
FOREIGN KEY (ID_PROJETO_AREA)
REFERENCES PROJETO_AREA(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_PAGAR_ATIVIDADE
ADD CONSTRAINT FK_CONTA_PAGAR_ATIVIDADE_4
FOREIGN KEY (ID_PROJETO_AREA)
REFERENCES PROJETO_AREA(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_RECEBER_ATIVIDADE
    ADD ID_PROJETO_AREA INTEGER NOT NULL;



UPDATE CONTA_RECEBER_ATIVIDADE
SET ID_PROJETO_AREA = 0;



ALTER TABLE CONTA_RECEBER_ATIVIDADE
ADD CONSTRAINT FK_CONTA_RECEBER_ATIVIDADE_3
FOREIGN KEY (ID_PROJETO_AREA)
REFERENCES PROJETO_AREA(ID)
ON UPDATE CASCADE;



ALTER TABLE CONTA_RECEBER_PROJETO
    ADD ID_PROJETO_AREA INTEGER;



ALTER TABLE CONTA_RECEBER_PROJETO
ADD CONSTRAINT FK_CONTA_RECEBER_PROJETO_3
FOREIGN KEY (ID_PROJETO_AREA)
REFERENCES PROJETO_AREA(ID)
ON UPDATE CASCADE;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'ID_PROJETO_AREA') and
(RDB$RELATION_NAME = 'CONTA_RECEBER_PROJETO')
;



ALTER TABLE LOTE_MUDA
    ADD ID_COMPRA INTEGER;

alter table LOTE_MUDA
alter ID position 1;

alter table LOTE_MUDA
alter ID_ESPECIE position 2;

alter table LOTE_MUDA
alter ID_LOTE_SEMENTE position 3;

alter table LOTE_MUDA
alter ID_COMPRA position 4;

alter table LOTE_MUDA
alter NOME position 5;

alter table LOTE_MUDA
alter QTDE_INICIAL position 6;

alter table LOTE_MUDA
alter DATA position 7;

alter table LOTE_MUDA
alter OBSERVACAO position 8;

alter table LOTE_MUDA
alter TAXA_CLASSIFICACAO position 9;



ALTER TABLE LOTE_MUDA
ADD CONSTRAINT FK_LOTE_MUDA_3
FOREIGN KEY (ID_COMPRA)
REFERENCES COMPRA(ID)
ON UPDATE CASCADE;



alter table LOTE_SEMENTE
alter ID position 1;

alter table LOTE_SEMENTE
alter ID_ESPECIE position 2;

alter table LOTE_SEMENTE
alter ID_PESSOA_COLETOU position 3;

alter table LOTE_SEMENTE
alter ID_COMPRA position 4;

alter table LOTE_SEMENTE
alter NOME position 5;

alter table LOTE_SEMENTE
alter DATA position 6;

alter table LOTE_SEMENTE
alter QTDE position 7;

alter table LOTE_SEMENTE
alter QTDE_ARMAZENADA position 8;

alter table LOTE_SEMENTE
alter TAXA_GERMINACAO position 9;

alter table LOTE_SEMENTE
alter TAXA_DESCARTE position 10;

alter table LOTE_SEMENTE
alter STATUS position 11;



ALTER TABLE SOLICITACAO_COMPRA
    ADD ID_ESPECIE INTEGER,
    ADD OBSERVACAO D_DESCRICAO;

alter table SOLICITACAO_COMPRA
alter ID position 1;

alter table SOLICITACAO_COMPRA
alter ID_ITEM position 2;

alter table SOLICITACAO_COMPRA
alter ID_PESSOA_SOLICITOU position 3;

alter table SOLICITACAO_COMPRA
alter ID_PESSOA_ANALISOU position 4;

alter table SOLICITACAO_COMPRA
alter ID_COMPRA position 5;

alter table SOLICITACAO_COMPRA
alter ID_ESPECIE position 6;

alter table SOLICITACAO_COMPRA
alter QTDE position 7;

alter table SOLICITACAO_COMPRA
alter DATA position 8;

alter table SOLICITACAO_COMPRA
alter DATA_ANALISE position 9;

alter table SOLICITACAO_COMPRA
alter STATUS position 10;

alter table SOLICITACAO_COMPRA
alter OBSERVACAO position 11;



ALTER TABLE SOLICITACAO_COMPRA
ADD CONSTRAINT FK_SOLICITACAO_COMPRA_5
FOREIGN KEY (ID_ESPECIE)
REFERENCES ESPECIE(ID)
ON UPDATE CASCADE;



CREATE TABLE SOLICITACAO_COMPRA_ITEM (
    ID INTEGER NOT NULL,
    ID_SOLICITACAO_COMPRA INTEGER NOT NULL,
    ID_ITEM INTEGER NOT NULL,
    ID_ESPECIE INTEGER,
    QTDE NUMERIC(15,2) NOT NULL);

ALTER TABLE SOLICITACAO_COMPRA_ITEM
ADD CONSTRAINT PK_SOLICITACAO_COMPRA_ITEM
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_SOLICITACAO_COMPRA_ITEM;



COMMENT ON COLUMN SOLICITACAO_COMPRA_ITEM.ID_ESPECIE IS
'Somente deve ser preenchido caso o item seja do tipo semente ou muda';



ALTER TABLE SOLICITACAO_COMPRA_ITEM
ADD CONSTRAINT FK_SOLICITACAO_COMPRA_ITEM_1
FOREIGN KEY (ID_SOLICITACAO_COMPRA)
REFERENCES SOLICITACAO_COMPRA(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;

ALTER TABLE SOLICITACAO_COMPRA_ITEM
ADD CONSTRAINT FK_SOLICITACAO_COMPRA_ITEM_2
FOREIGN KEY (ID_ITEM)
REFERENCES ITEM(ID)
ON UPDATE CASCADE;

ALTER TABLE SOLICITACAO_COMPRA_ITEM
ADD CONSTRAINT FK_SOLICITACAO_COMPRA_ITEM_3
FOREIGN KEY (ID_ESPECIE)
REFERENCES ESPECIE(ID)
ON UPDATE CASCADE;



COMMENT ON COLUMN SOLICITACAO_COMPRA.ID_ESPECIE IS
'Somente deve ser preenchido caso o item seja do tipo semente ou muda';



ALTER TABLE SOLICITACAO_COMPRA DROP CONSTRAINT FK_SOLICITACAO_COMPRA_1;



ALTER TABLE SOLICITACAO_COMPRA DROP CONSTRAINT FK_SOLICITACAO_COMPRA_5;



ALTER TABLE SOLICITACAO_COMPRA DROP ID_ITEM;



ALTER TABLE SOLICITACAO_COMPRA DROP ID_ESPECIE;



ALTER TABLE SOLICITACAO_COMPRA DROP QTDE;

