

ALTER TABLE ATIVIDADE
    ADD DATA_FINALIZACAO TIMESTAMP;

COMMENT ON COLUMN ATIVIDADE.DATA_FINALIZACAO IS
'Data em que a atividade teve seu status alterado para finalizada ou cancelada';



CREATE TABLE AREA_ATUACAO (
    ID INTEGER NOT NULL,
    NOME D_NOME NOT NULL);

ALTER TABLE AREA_ATUACAO
ADD CONSTRAINT PK_AREA_ATUACAO
PRIMARY KEY (ID);

ALTER TABLE AREA_ATUACAO
ADD CONSTRAINT UNQ1_AREA_ATUACAO
UNIQUE (NOME);

CREATE SEQUENCE GEN_AREA_ATUACAO;



CREATE TABLE AREA_EXECUCAO (
    ID INTEGER NOT NULL,
    ID_AREA_ATUACAO INTEGER NOT NULL,
    NOME D_NOME NOT NULL);

ALTER TABLE AREA_EXECUCAO
ADD CONSTRAINT PK_AREA_EXECUCAO
PRIMARY KEY (ID);

CREATE SEQUENCE GEN_AREA_EXECUCAO;



ALTER TABLE AREA_EXECUCAO
ADD CONSTRAINT FK_AREA_EXECUCAO_1
FOREIGN KEY (ID_AREA_ATUACAO)
REFERENCES AREA_ATUACAO(ID)
ON DELETE CASCADE
ON UPDATE CASCADE;


ALTER TABLE PROJETO_AREA
    ADD ID_AREA_ATUACAO INTEGER;



ALTER TABLE PROJETO_AREA DROP CONSTRAINT UNQ1_PROJETO_AREA;


insert into Area_Atuacao
select distinct(next value for Gen_Area_Atuacao),
               Projeto_Area.Nome
from Projeto_Area;


update Projeto_Area
set Projeto_Area.Id_Area_Atuacao = (select first 1 Area_Atuacao.Id
                                   from Area_Atuacao
                                   where Area_Atuacao.Nome = Projeto_Area.Nome);
								   
								   



ALTER TABLE PROJETO_AREA
ADD CONSTRAINT UNQ1_PROJETO_AREA
UNIQUE (ID_PROJETO,ID_AREA_ATUACAO);



ALTER TABLE PROJETO_AREA DROP NOME;



update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'ID_AREA_ATUACAO') and
(RDB$RELATION_NAME = 'PROJETO_AREA')
;



